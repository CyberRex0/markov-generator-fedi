<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <title>マルコフ連鎖ジェネレーター for Fediverse</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <style type="text/css">
            body {
                margin: 4px;
            }
        </style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
        <script type="text/javascript">
            function clipboard_set(text){
                var pre = document.createElement('pre');
                pre.style.webkitUserSelect = 'auto';
                pre.style.userSelect = 'auto';
                pre.textContent = text;
                document.body.appendChild(pre);
                document.getSelection().selectAllChildren(pre);
                var result = document.execCommand('copy');
                document.body.removeChild(pre);

                return result;
            }
        </script>

        <!-- OGP -->
        <meta property="og:title" content="マルコフ連鎖ジェネレーター for Fediverse">
        <meta property="og:type" content="website">
        {% if not request.args.get('preset') %}
        <meta property="og:url" content="https://{{ request.host }}/">
        <meta property="og:description" content="あなたのMisskey/Mastodonアカウントの投稿を学習して文章を生成します">
        {% else %}
        <meta property="og:url" content="https://{{ request.host }}/generate?preset={{ up.quote(request.args.get('preset')) }}">
        <meta property="og:description" content="{{ request.args.get('preset') }}さんの学習データで文章を作ってみよう！">
        {% endif %}
    </head>
    <body>
        <div class="container">

            <div>
                <a href="/">Top</a> &gt; 文章生成
            </div>

            <h1>文章生成</h1>

            <div class="card" style="width: 25rem;">
                <div class="card-header">
                    設定
                </div>
                <ul class="list-group list-group-flush">
                <form action="/generate/do" method="GET">
                    <li class="list-group-item">
                        <input type="text" name="acct" class="form-control" placeholder="username@host" aria-label="ユーザー名" value="{{ acct or request.args.get('preset', '') }}">
                        <input type="submit" class="btn btn-primary" value="生成">
                        {% if session.get('logged_in') %}
                        <br>
                        <small>何も指定しないときは現在ログインしているアカウントの学習データを使用します</small>
                        {% endif %}
                    </li>
                </form>
                </ul>
            </div>

            {% if text %}
            <div class="card" style="width: 25rem;">
                <div class="card-header">
                    生成された文章
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        {{ text }}
                    </li>
                </ul>
            </div>
            <br>
            <div>
                <button id="copyButton" class="btn btn-primary" data-bs-trigger="manual" data-toggle="tooltip" data-bs-placement="bottom" title="コピーしました"><i class="bi bi-clipboard"></i>クリップボードにコピー</button>
                &nbsp;
                <button class="btn btn-primary" data-bs-toggle="tooltip" data-bs-placement="bottom" title="文章を再生成します" onclick="location.reload();"><i class="bi bi-arrow-clockwise"></i></button>
            </div>
            {% endif %}

        </div>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script type="text/javascript">
            window.addEventListener('load', function () {
                $('[data-toggle="tooltip"]').tooltip();

                $('#copyButton').tooltip({
                    'title': 'コピーしました',
                    'trigger': 'manual',
                    'placement': 'bottom'
                });

                $('#copyButton').on('click', function () {
                    clipboard_set(decodeURIComponent('{{ share_text }}'));
                    $('#copyButton').tooltip('show');
                });
                $('#copyButton').on('shown.bs.tooltip', function () {
                    setTimeout((function () {
                        $(this).tooltip('hide');
                    }).bind(this), 2000);
                });

            });
        </script>
    </body>
</html>